<div class="container-fluid pt-4 px-4">
    <div class="row g-4">
        <!-- Lucros dos Últimos 5 Dias -->
        <div class="col-md-6">
            <div class="bg-secondary rounded p-4">
                <h6 class="mb-4"><i class="fa fa-money-bill-wave text-success"></i> Lucros dos Últimos 15 Dias</h6>
                <div class="table-responsive" style="max-height: 220px; overflow-y: auto;">
                    <table class="table text-start align-middle table-bordered table-hover mb-0">
                        <thead>
                            <tr class="text-white">
                                <th scope="col">Data</th>
                                <th scope="col">Lucro (R$)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for profit in daily_profits|slice:":15" %}
                            <tr>
                                <td>{{ profit.created_at__date }}</td>
                                <td class="{% if profit.total_profit > 0 %}text-success{% else %}text-danger{% endif %}">
                                    R$ {{ profit.total_profit|floatformat:2 }}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="2" class="text-center">Sem dados de lucros recentes.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Top 50 Traders do Dia (Mostra Apenas 5 e Scroll) -->
        <div class="col-md-6">
            <div class="bg-secondary rounded p-4">
                <h6 class="mb-4">
                    <i class="fa fa-trophy text-warning"></i> Top 50 Traders
                    <button class="btn btn-sm btn-success mx-3" onclick="sortTraders('desc')"> Lucro</button>
                    <button class="btn btn-sm btn-danger" onclick="sortTraders('asc')">Prejuízo</button>
                </h6>
              
        
                <div class="list-group" id="trader-list" style="max-height: 220px; overflow-y: auto;">
                    {% for trader in top_traders|slice:":50" %}
                    <div class="list-group-item bg-dark text-white d-flex justify-content-between">
                        <span>
                            <i class="fa fa-user {% if trader.name == request.user.email %}text-primary{% else %}text-info{% endif %}"></i>
                            {{ trader.name }}
                        </span>
                        <span class="{% if trader.profit_amount > 0 %}text-success{% else %}text-danger{% endif %}">
                            R$ <span class="profit-amount">{{ trader.profit_amount|floatformat:2 }}</span> 
                            ({{ trader.profit_percentage }}%)
                        </span>
                    </div>
                    {% empty %}
                    <div class="list-group-item text-center">Nenhum trader listado.</div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function sortTraders(order) {
        const traderList = document.getElementById("trader-list");
        const traders = Array.from(traderList.getElementsByClassName("list-group-item"));
    
        traders.sort((a, b) => {
            // Obtendo os valores do lucro (positivo ou negativo)
            const profitA = parseFloat(a.querySelector(".profit-amount").innerText.replace(",", "."));
            const profitB = parseFloat(b.querySelector(".profit-amount").innerText.replace(",", "."));
    
            // Ordenação baseada no valor absoluto
            return order === "desc" ? profitB - profitA : profitA - profitB;
        });
    
        // Atualiza a exibição dos traders no DOM
        traders.forEach(trader => traderList.appendChild(trader));
    }
</script>
    
